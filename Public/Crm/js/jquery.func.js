//tap
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('$.w.G=3(a){6 b=m,1="K"f z.H("I"),n=1?"L":"P",o=1?"x":"y",v=1?"A":"B",C=1?"D":"E";b.F(3(){6 i={};i.8=m;$(i.8).l(n,3(e){6 p="2"f e?e.2[0]:(1?7.5.2[0]:7.5);i.j=p.k;i.d=p.h;i.c=p.k;i.9=p.h;i.g=+q r});$(i.8).l(o,3(e){6 p="2"f e?e.2[0]:(1?7.5.2[0]:7.5);i.c=p.k;i.9=p.h});$(i.8).l(v,3(e){s((+q r)-i.g<J){s(t.u(i.c-i.j)+t.u(i.9-i.d)<M){6 e=e||7.5;e.N();a.O(i.8)}}i.g=4;i.j=4;i.d=4;i.c=4;i.9=4})});Q b}',53,53,'|isTouch|touches|function|undefined|event|var|window|target|endY|||endX|startY||in|startTime|clientY||startX|clientX|on|this|tstart|tmove||new|Date|if|Math|abs|tend|fn|touchmove|mousemove|document|touchend|mouseup|tcancel|touchcancel|mouseout|each|tap|createElement|div|300|ontouchend|touchstart|20|preventDefault|call|mousedown|return'.split('|'),0,{}));

//lazyload
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('(1($,l,m,n){6 o=$(l);$.1H.1G=1(h){6 i=8;6 j;6 k={7:0,M:0,v:"N",X:"1F",4:l,J:"1E",18:1a,r:V,B:V,Z:"E:11/1D;1C,1z+1y/1x"};1 A(){6 b=0;i.S(1(){6 a=$(8);2(k.18&&!a.K(":1w")){3}2($.O(8,k)||$.P(8,k)){}s 2(!$.u(8,k)&&!$.q(8,k)){a.F("r");b=0}s{2(++b>k.M){3 G}}})}2(h){2(n!==h.H){h.M=h.H;U h.H}2(n!==h.I){h.W=h.I;U h.I}$.1c(k,h)}j=(k.4===n||k.4===l)?o:$(k.4);2(0===k.v.Y("N")){j.w(k.v,1(){3 A()})}8.S(1(){6 f=8;6 g=$(f);f.x=G;2(g.p("y")===n||g.p("y")===G){2(g.K("Q")){g.p("y",k.Z)}}g.1e("r",1(){2(!8.x){2(k.r){6 e=i.16;k.r.17(f,e,k)}$("<Q />").w("B",1(){6 b=g.p("E-"+k.J);g.1u();2(g.K("Q")){g.p("y",b)}s{g.1t("1s-11","1r(\'"+b+"\')")}g[k.X](k.W);f.x=1a;6 c=$.1o(i,1(a){3!a.x});i=$(c);2(k.B){6 d=i.16;k.B.17(f,d,k)}}).p("y",g.p("E-"+k.J))}});2(0!==k.v.Y("N")){g.w(k.v,1(){2(!f.x){g.F("r")}})}});o.w("1f",1(){A()});2((/(?:1v|1g|1h).*1i 5/1j).1k(1l.1m)){o.w("1n",1(a){2(a.1d&&a.1d.1p){i.S(1(){$(8).F("r")})}})}$(m).1q(1(){A()});3 8};$.u=1(a,b){6 c;2(b.4===n||b.4===l){c=(l.1b?l.1b:o.T())+o.19()}s{c=$(b.4).9().z+$(b.4).T()}3 c<=$(a).9().z-b.7};$.q=1(a,b){6 c;2(b.4===n||b.4===l){c=o.L()+o.15()}s{c=$(b.4).9().t+$(b.4).L()}3 c<=$(a).9().t-b.7};$.O=1(a,b){6 c;2(b.4===n||b.4===l){c=o.19()}s{c=$(b.4).9().z}3 c>=$(a).9().z+b.7+$(a).T()};$.P=1(a,b){6 c;2(b.4===n||b.4===l){c=o.15()}s{c=$(b.4).9().t}3 c>=$(a).9().t+b.7+$(a).L()};$.13=1(a,b){3!$.q(a,b)&&!$.P(a,b)&&!$.u(a,b)&&!$.O(a,b)};$.1c($.1A[":"],{"1B-R-C":1(a){3 $.u(a,{7:0})},"14-R-z":1(a){3!$.u(a,{7:0})},"10-D-12":1(a){3 $.q(a,{7:0})},"t-D-12":1(a){3!$.q(a,{7:0})},"1I-1J":1(a){3 $.13(a,{7:0})},"14-R-C":1(a){3!$.u(a,{7:0})},"10-D-C":1(a){3 $.q(a,{7:0})},"t-D-C":1(a){3!$.q(a,{7:0})}})})(1K,1L,1M);',62,111,'|function|if|return|container||var|threshold|this|offset||||||||||||||||attr|rightoffold|appear|else|left|belowthefold|event|bind|loaded|src|top|update|load|fold|of|data|trigger|false|failurelimit|effectspeed|data_attribute|is|width|failure_limit|scroll|abovethetop|leftofbegin|img|the|each|height|delete|null|effect_speed|effect|indexOf|placeholder|right|image|screen|inviewport|above|scrollLeft|length|call|skip_invisible|scrollTop|true|innerHeight|extend|originalEvent|one|resize|ipod|ipad|os|gi|test|navigator|appVersion|pageshow|grep|persisted|ready|url|background|css|hide|iphone|visible|AAffA0nNPuCLAAAAAElFTkSuQmCC|PB|iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8|expr|below|base64|png|original|show|lazyload|fn|in|viewport|jQuery|window|document'.split('|'),0,{}));
$(function() {
	$.rendLazy=function(){
		$("img.lazy").lazyload({
			effect : "fadeIn"
		});
	};
});

/*!art-template - Template Engine | http://aui.github.com/artTemplate/*/
!function(){function a(a){return a.replace(t,"").replace(u,",").replace(v,"").replace(w,"").replace(x,"").split(y)}function b(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function c(c,d){function e(a){return m+=a.split(/\n/).length-1,k&&(a=a.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),a&&(a=s[1]+b(a)+s[2]+"\n"),a}function f(b){var c=m;if(j?b=j(b,d):g&&(b=b.replace(/\n/g,function(){return m++,"$line="+m+";"})),0===b.indexOf("=")){var e=l&&!/^=[=#]/.test(b);if(b=b.replace(/^=[=#]?|[\s;]*$/g,""),e){var f=b.replace(/\s*\([^\)]+\)/,"");n[f]||/^(include|print)$/.test(f)||(b="$escape("+b+")")}else b="$string("+b+")";b=s[1]+b+s[2]}return g&&(b="$line="+c+";"+b),r(a(b),function(a){if(a&&!p[a]){var b;b="print"===a?u:"include"===a?v:n[a]?"$utils."+a:o[a]?"$helpers."+a:"$data."+a,w+=a+"="+b+",",p[a]=!0}}),b+"\n"}var g=d.debug,h=d.openTag,i=d.closeTag,j=d.parser,k=d.compress,l=d.escape,m=1,p={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},q="".trim,s=q?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],t=q?"$out+=text;return $out;":"$out.push(text);",u="function(){var text=''.concat.apply('',arguments);"+t+"}",v="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+t+"}",w="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(g?"$line=0,":""),x=s[0],y="return new String("+s[3]+");";r(c.split(h),function(a){a=a.split(i);var b=a[0],c=a[1];1===a.length?x+=e(b):(x+=f(b),c&&(x+=e(c)))});var z=w+x+y;g&&(z="try{"+z+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+b(c)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var A=new Function("$data","$filename",z);return A.prototype=n,A}catch(B){throw B.temp="function anonymous($data,$filename) {"+z+"}",B}}var d=function(a,b){return"string"==typeof b?q(b,{filename:a}):g(a,b)};d.version="3.0.0",d.config=function(a,b){e[a]=b};var e=d.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},f=d.cache={};d.render=function(a,b){return q(a,b)};var g=d.renderFile=function(a,b){var c=d.get(a)||p({filename:a,name:"Render Error",message:"Template not found"});return b?c(b):c};d.get=function(a){var b;if(f[a])b=f[a];else if("object"==typeof document){var c=document.getElementById(a);if(c){var d=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,"");b=q(d,{filename:a})}}return b};var h=function(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?h(a.call(a)):""),a},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},j=function(a){return i[a]},k=function(a){return h(a).replace(/&(?![\w#]+;)|[<>"']/g,j)},l=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},m=function(a,b){var c,d;if(l(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)},n=d.utils={$helpers:{},$include:g,$string:h,$escape:k,$each:m};d.helper=function(a,b){o[a]=b};var o=d.helpers=n.$helpers;d.onerror=function(a){var b="Template Error\n\n";for(var c in a)b+="<"+c+">\n"+a[c]+"\n\n";"object"==typeof console&&console.error(b)};var p=function(a){return d.onerror(a),function(){return"{Template Error}"}},q=d.compile=function(a,b){function d(c){try{return new i(c,h)+""}catch(d){return b.debug?p(d)():(b.debug=!0,q(a,b)(c))}}b=b||{};for(var g in e)void 0===b[g]&&(b[g]=e[g]);var h=b.filename;try{var i=c(a,b)}catch(j){return j.filename=h||"anonymous",j.name="Syntax Error",p(j)}return d.prototype=i.prototype,d.toString=function(){return i.toString()},h&&b.cache&&(f[h]=d),d},r=n.$each,s="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",t=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,u=/[^\w$]+/g,v=new RegExp(["\\b"+s.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),w=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,y=/^$|,+/;"function"==typeof define?define(function(){return d}):"undefined"!=typeof exports?module.exports=d:this.template=d}();


var tap_click= "click";
$(function(){
	
	$(".screening .item").on(tap_click,function(){	 	
		$(".down-menu .item").eq($(this).index()).toggle().siblings().hide();	 	
	});
	 
	//二级分类下拉
	
	$("#menu").on(tap_click,function(){
   		$(".submenu,.zheb").fadeToggle("fast");		
   	}); 
	$(".zheb").on(tap_click,function(){
   		$(".submenu").fadeOut("fast");   
   		$(this).fadeOut("fast");   
   	});   
   	$(".zheb").on("touchstart",function(e){
   		e.preventDefault();
   	});
	
	//获取购物车信息
	$.getCartInfo=function(){
		var url=APP_PATH+"Cart/info";	
		$.ajax({url:url,success: function(data){ 
			if(data.cart_num>0){
				var data = {list:data.cart_items,cart_num:data.cart_num,cart_amount:data.cart_amount}; 
				if($("#tpl_cart").length>0){
					var html = template('tpl_cart', data); 
					$("#mycartbox").html(html); 
				}
				$("#cartnum").text(data.cart_num);
			 }else{
				$("#mycartbox").html("<div class='noresult'><img src='/Public/Home/images/cart_empty.png' style='width:50%; margin:20px 0px 40px;' /><br />购物车为空</div>"); 
				$("#cartnum").text(0);
			 } 
		}
		});
		
	}
	//确认订单
	$.confirmOrder=function(orderno){
		if(confirm("您确定收到货了吗？")){ 
		var url=APP_PATH+"Member/confirmOrder?orderno="+orderno;	
		$.ajax({url:url,success: function(data){
			if(data.status==1){
				alertok(data.info);
				location.reload();
			}else{
				alerterr(data.info);
			}
		}
		});
		}
	}
	//取消订单
	$.cancelOrder=function(orderno){
		if(confirm("您确定取消该订单吗？")){
		var url=APP_PATH+"Member/cancelOrder?orderno="+orderno;	
		$.ajax({url:url,success: function(data){
			if(data.status==1){
				mui.alert(data.info,'', function () {
					window.location.href="/Member/order.html";
				});
				//alertok(data.info);

				//location.reload();
			}else{
				alerterr(data.info);
			}
		}
		});
		}
	}
	 
	//加入购物车
	$.addCart=function(id){
		var attrs=showkeys();
		attrs.replace(/,$/g,"");

		if(!attrs)
			return;
		var num=(arguments[1]==undefined?1:arguments[1]);

		if(num<=0){
			mui.toast('请选择数量');
			return;
		}

		var url=APP_PATH+"Cart/add?item_id="+id+"&num="+num+"&attrs="+attrs;
		$.ajax({url:url,success: function(data){
			if(data.status==1){
				mui.toast("恭喜，商品已加入购物车！");
				$.getCartInfo();
			}else{
				mui.toast(data.info);
			}
		}
		});

	};
	
	//修改购物车
	$.editCart=function(id,num){
		var url=APP_PATH+"Cart/edit?item_id="+id+"&num="+num;	
		$.ajax({url:url,success: function(data){
			if(data.status==1){
				//alertok("恭喜，商品数量修改成功！");
				$.getCartInfo();
			}else{
				mui.toast(data.info);
			}
		}
		});

	};
	
	
	//删除购物车
	$.delCart=function(id){
		if(confirm("您确定移除该商品吗？")){
		var url=APP_PATH+"Cart/del?item_id="+id;	
		$.ajax({url:url,success: function(data){
			if(data.status==1){
				//alertok("恭喜，商品已从购物车移除！");
				$.getCartInfo();
			}else{
				alerterr("对不起，购物车移除商品失败！");
			}
		}
		});
		}
		
	};
	
	//添加按钮
	$(".addCart").click(function(){
		var $id=$(this).attr("data-id");
		var $num=$("#product_num").val();
		$.addCart($id,$num);	
	});
	
	//立即购买
	$(".buyCart").click(function(){
		var $id=$(this).attr("data-id");
		var $num=$("#product_num").val();
		if($num<=0){
			mui.toast('请选择数量');return;
		}
		var attrs=showkeys();
		if(!attrs){
			return;
		}
		var url=APP_PATH+"Cart/add?item_id="+$id+"&num="+$num+"&attrs="+attrs;
		$.ajax({url:url,success: function(data){
			if(data.status==1){
				location=APP_PATH+"Settle/cart.html";
			}else{
				alerterr(data.info);
			}
		}
		});
	});
	
	
	$("body").on("change",".cartnum",function(){
	//$(".cartnum").on("change",function() {
        var v = $(this).val();
		if (isNaN(v)) {
			v = 1
		}else{
			v=parseInt(v);	
		}
		
		var stock=$(this).attr("data-stock"); 
		var id=$(this).attr("data-id"); 
		if(stock!=undefined){  
			
			if (isNaN(stock)) {
				stock = 0
			}else{
				stock=parseInt(stock);	
			}
			
			if(v>stock){
				$(this).val(stock);
				alerterr("库存不足");
				return false;	
			} 
		}
		if(id!=undefined){  
			$.editCart(id,v);
		}
    });
	
	$("body").on("click",".btnPlus",function(){ 
        var v = $(this).prev("input").val(); 
       if (isNaN(v)) {
            v = 1
        }else{
			v=parseInt(v);	
		}
		 
		v++;
        $(this).prev("input").val(v).change(); 
		
		var num=parseFloat($(this).prev("input").val());	
		var price=parseFloat($(this).prev("input").attr("data-price"));
		var nAmount = 0;
			nAmount = num*price; 
			nAmount = nAmount.toFixed(2);
		var o=$(this).parent().find(".CartAmount");
			o.html(nAmount);
			
        return false;
    });
	
	$("body").on("click",".btnDeduct",function(){ 
        var v = $(this).next("input").val();
        if (isNaN(v)) {
            v = 1
        }
        v--;
        if (v < 1) {
            v = 1 
		}else{
			$(this).next("input").val(v).change();	
			var num=parseFloat($(this).next("input").val());	
			var price=parseFloat($(this).next("input").attr("data-price"));
			var nAmount = 0;
				nAmount = num*price; 
			nAmount = nAmount.toFixed(2);
			var o=$(this).parent().find(".CartAmount");
				o.html(nAmount);
		}
		
        return false;
    });
	
});

function alertok($str){
	mui.toast($str);
}

function alerterr($str){
	mui.toast($str);
}
function logerr($str){
	console.log($str);	
}
function reloadwin(){
	setTimeout(function(){location.reload()},500);	
}

var refreshAuthCode = function() {
    var n = APP_PATH+"Index/verify?" + Math.random(); 
    $("img#authCode").attr("src", n)
};

function InitArea() {
	var url =APP_PATH+"Index/getArea";
	
	  $("#China_Province").change(function() {
        $("#China_City,#China_District,#China_Street").hide();
		var url1 =url+ "?tbl=china_city&id="+$(this).val()+"&" + Math.random();
        $.ajax({
            url: url1,
            success: function(msg) {
                $("#China_City").html(msg);
                $("#China_City").show()
            }
        })
    });
    $("#China_City").change(function() {
        $("#China_District,#China_Street").hide();
		var url1 =url+"?tbl=china_district&id="+$(this).val()+"&" + Math.random();
        $.ajax({
            url: url1,
            success: function(msg) {
                $("#China_District").html(msg);
                $("#China_District").show()
            }
        })
    })
    $("#China_District").change(function() {
        $("#China_Street").hide();
		var url1 =url+"?tbl=china_street&id="+$(this).val()+"&" + Math.random();
        $.ajax({
            url: url1,
            success: function(msg) {
                $("#China_Street").html(msg);
				if(msg==""){
					$("#China_Street").hide()
				}else{
              	  $("#China_Street").show()
				}
            }
        })
    })
};

//订单提交页-验证手机号  
function is_mobile(mobile) {  
     if( mobile == "") {  
      return false;  
     } else {  
       if( ! /^0{0,1}(13[0-9]|15[0-9]|18[0-9]|14[0-9])[0-9]{8}$/.test(mobile) ) {  
        return false;  
      }  
      return true;  
    }  
}  
  
//订单提交页-验证email的合法性  
function is_email(email) {  
    if ( email == "") {  
        return false;  
    } else {  
        if (! /^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/.test(email)) {  
            return false;  
        }  
    }  
    return true;  
}


