<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>{$title}</title>
		<include file="Public:newscripts1" />
		<js href="__PUBLIC__/newcss1/js/jquery.md5.js" />
		<style type="text/css">
			input::-webkit-input-placeholder {
				color: #999;
			}
			
			input::-moz-placeholder {
				/* Mozilla Firefox 19+ */
				color: #999;
			}
			
			input:-moz-placeholder {
				/* Mozilla Firefox 4 to 18 */
				color: #999;
			}
			
			input:-ms-input-placeholder {
				/* Internet Explorer 10-11 */
				color: #999;
			}
			
			.input-box>div {
				padding: 0.14rem 0.08rem;
				width: 94%;
				margin: 0 auto;
				box-sizing: border-box;
				position: relative;
				overflow: hidden;
			}
			
			.vertical-top{
				margin: 0.12rem 0.12rem 0;
				padding-left:0.12rem ;
				position: relative;
				font-weight: bold;
				color: #999;
				font-size: 0.14rem;
			}
			.vertical-top:before{
				content: "";
				display: block;
				background: #E6BC85;
				width: 0.04rem;
				position: absolute;
				left: 0;
				top: 0;

				height: 100%;
			}
			
			.input-box>div:after {
				left: 0;
				content: "";
				position: absolute;
				bottom: 0;
				border-bottom: 1px solid #CCCCCC;
				width: 100%;
				-webkit-transform: scaley(.3);
				transform: scaley(.3);
			}
			
			.input-box>div:last-child:after {
				border: 0;
			}
			
			.input-box span {
				display: inline-block;
				text-align: center;
				color: #000;
				float: left;
				width: 0.9rem;
				text-align: left;
			}
			
			.input-box .input-p {
				margin-left: 0.9rem;
			}
			
			.input-box input {
				border: 0;
				width: 100%;
			}
			
		</style>
	</head>

	<body style="background: #f5f5f5;">
		<div class="vertical-top">
			请填写个人信息
		</div>
		<section class="input-box" style="margin: 0.12rem;background: #fff;border-radius:0.2rem ;font-size: 0.14rem;">
			<div>
				<span>姓名</span>
				<p class="input-p">
					<input type="text" name="username" id="username" value="{$db.username}" placeholder="请输入真实姓名" />
				</p>
			</div>
			<div>
				<span>身份证号</span>
				<p class="input-p">
					<input type="text" name="idcard" id="idcard" value="{$db.idcard}" placeholder="请输入身份证号" />
				</p>
			</div>
			<div>
				<span>手机号码</span>
				<p class="input-p">
					<input type="text" name="telephone" id="telephone" value="{$db.telephone}" readonly placeholder="请输入手机号码" />
				</p>
			</div>
		</section>

		<div class="vertical-top">
			请上传身份证照片（正面）
		</div>
		<style type="text/css">
			.zj img{
				width: 100%;
			}
		</style>
		<section class="input-box zj" style="margin: 0.12rem;background: #fff;border-radius:0.2rem ;font-size: 0.14rem;">
			<input type="file"  data="idcardimg1" style="display: none;" class="uploadpic"  />
			<div onclick="$(this).prev('.uploadpic').click();"  class="idcardimg1" style="height: 2.1rem;position: relative;background: url(/Public/newcss/img/jia.png) no-repeat center / 0.5rem 0.5rem;">
				<notempty name="db.idcardimg1">
					<img class="idimg"  src="{$db.idcardimg1}">
				</notempty>
			</div>
			<input type="hidden" name="idcardimg1" value="{$db.idcardimg1}" />
		</section>



		<div class="vertical-top">
			请上传身份证照片（反面）
		</div>
		<section class="input-box zj" style="margin: 0.12rem;background: #fff;border-radius:0.2rem ;font-size: 0.14rem;">
			<input type="file"  data="idcardimg2" style="display: none;" class="uploadpic" />
			<div onclick="$(this).prev('.uploadpic').click();" class="idcardimg2" style="height: 2.1rem;position: relative;background: url(/Public/newcss/img/jia.png) no-repeat center / 0.5rem 0.5rem;">
				<notempty name="db.idcardimg1">
					<img class="idimg"  src="{$db.idcardimg2}">
				</notempty>
			</div>
			<input type="hidden" name="idcardimg2" value="{$db.idcardimg2}" />
		</section>

		<div class="vertical-top">
			请上传手持身份证照片
		</div>
		<style type="text/css">
			.zj img{
				width: 100%;
			}
		</style>
		<section class="input-box zj" style="margin: 0.12rem;background: #fff;border-radius:0.2rem ;font-size: 0.14rem;">
			<input type="file" data="idcardimg3" style="display: none;" class="uploadpic"  />
			<div onclick="$(this).prev('.uploadpic').click();"  class="idcardimg3" style="height: 2.1rem;position: relative;background: url(/Public/newcss/img/jia.png) no-repeat center / 0.5rem 0.5rem;">
				<notempty name="db.idcardimg3">
					<img class="idimg"  src="{$db.idcardimg3}">
				</notempty>
			</div>
			<input type="hidden" name="idcardimg3" value="{$db.idcardimg3}" />
		</section>

		<style type="text/css">
			.bot-btn {
				padding: 0.1rem 0.12rem;
				background: #fff;
				position: fixed;
				bottom: 0;
				left: 0;
				width: 100%;
				box-sizing: border-box;
				border-radius: 0.25rem 0.25rem 0 0;
				box-shadow: 0px 0px 8px 0px rgba(0, 0, 0, 0.1);
			}
			
			.bot-btn button {
				background: #e6bc85;
				height: 0.5rem;
				border-radius: 0.25rem;
				width: 100%;
				display: block;
				color: #fff;
				font-size: 0.2rem;
				line-height: 0.5rem;
				text-align: center;
				font-weight: bold;
				border: 0;
			}
			.footpadding{
				padding-top:0.5rem ;
			}
		</style>
		<div class="footpadding"></div>
		<div class="bot-btn">
			<button onclick="commitinfo()">
				完成
			</button>
		</div>
		<canvas id="myCanvas" style="display: none;"></canvas>
		<img id="agoimg" style="display:none;"/>
	</body>
	<script type="text/javascript ">



				function commitinfo(){
					var username=$("#username").val();
					var idcard=$("#idcard").val();
					var telephone=$("#telephone").val();
					var idcardimg1=$("input[name='idcardimg1']").val();
					var idcardimg2=$("input[name='idcardimg2']").val();
					var idcardimg3=$("input[name='idcardimg3']").val();
					if($.trim(username)==""||$.trim(username)==null){
						yjfunc.mytoast("姓名不能为空");return;
					}
					if($.trim(idcard)==""||$.trim(idcard)==null){
						yjfunc.mytoast("身份证号不能为空");return;
					}
					if($.trim(telephone)==""||$.trim(telephone)==null){
						yjfunc.mytoast("联系电话不能为空");return;
					}
					if($.trim(idcardimg1)==""||$.trim(idcardimg1)==null){
						yjfunc.mytoast("请上传身份证正面照");return;
					}
					if($.trim(idcardimg2)==""||$.trim(idcardimg2)==null){
						yjfunc.mytoast("请上传身份证反面照");return;
					}
					if($.trim(idcardimg3)==""||$.trim(idcardimg3)==null){
						yjfunc.mytoast("请上传手持身份证照片");return;
					}
					$.ajax({
						url:"/Member/subinfo.html",
						data:{username:username,idcard:idcard,telephone:telephone,idcardimg1:idcardimg1,idcardimg2:idcardimg2,idcardimg3:idcardimg3},
						type:"POST",
						success: function (data) {
							if(data.status==1){
								yjfunc.myconfirm(data.info,["确认"], function (e) {
									if(e==0){
										window.location.href="/Index/menu.html";
									}
								})
							}else{
								yjfunc.myconfirm(data.info);
							}
						}
					})

				}

		$(".deleimg").click(function () {
			var obj=$(this);
			yjfunc.myconfirm("确认删除该照片？",['取消','确认'], function (e) {
				if(e==1){
					obj.parent("span").parent("p").empty();
				}
			});
		});


	</script>
	<script>

        $.ajax({url: "/member/uptoken",dataType:"json", success: function(res) {
            var token = res.uptoken;
            $(".uploadpic").unbind("change").bind("change", function () {
				/*
				 *   本示例演示七牛云存储表单上传
				 *
				 *   按照以下的步骤运行示例：
				 *
				 *   1. 填写token。需要您不知道如何生成token，可以点击右侧的链接生成，然后将结果复制粘贴过来。
				 *   2. 填写key。如果您在生成token的过程中指定了key，则将其输入至此。否则留空。
				 *   3. 姓名是一个自定义的变量，如果生成token的过程中指定了returnUrl和returnBody，
				 *      并且returnBody中指定了期望返回此字段，则七牛会将其返回给returnUrl对应的业务服务器。
				 *      callbackBody亦然。
				 *   4. 选择任意一张照片，然后点击提交即可
				 *
				 *   实际开发中，您可以通过后端开发语言动态生成这个表单，将token的hidden属性设置为true并对其进行赋值。
				 *
				 *  **********************************************************************************
				 *  * 贡献代码：
				 *  * 1. git clone git@github.com:icattlecoder/jsfiddle
				 *  * 2. push代码到您的github库
				 *  * 3. 测试效果，访问 http://jsfiddle.net/gh/get/jquery/1.9.1/<Your GitHub Name>/jsfiddle/tree/master/ajaxupload
				 *  * 4. 提pr
				 *   **********************************************************************************
				 */
                var classes = $(this).attr('data');
                var file = this.files[0];
                var domain = res.domain;
                // eslint-disable-next-line
                if (file) {
                    var filename = file.name;
                    var ext = /\.[^\.]+/.exec(filename);
                    var key = domain + $.md5(domain + file.name) + ext;
                    Qiniu_upload(file, token, key,filename,classes);
                }
            })
        }});
        // 切换tab后进行一些css操作
        var Qiniu_UploadUrl = "http://up-z2.qiniup.com";
        var Qiniu_upload = function(f, token, key,filename,classes) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', Qiniu_UploadUrl, true);
            var formData, startDate;
            formData = new FormData();
            if (key !== null && key !== undefined) formData.append('key', key);
            formData.append('token', token);
            formData.append('file', f);
            var taking;
            xhr.upload.addEventListener("progress", function(evt) {

            }, false);

            xhr.onreadystatechange = function(response) {
                if (xhr.readyState == 4 && xhr.status == 200 && xhr.responseText != "") {
                  saveimg(filename,key,classes);
                } else if (xhr.status != 200 && xhr.responseText) {

                }
            };
            startDate = new Date().getTime();
            xhr.send(formData);
        };

        function saveimg(filename,key,classes){
            $.ajax({
                url:"/Member/saveqiniuimg.html",
                data:{filename:filename,key:key},
                type:"POST",
                success: function (data) {
                    if(data.status==1){
                        var html="<img class=\"idimg\" style=\"width:100%;height:100%\" src=\""+data.info+"\"/>" ;
//              + "<span class=\"delespan\">" +
//              "<img class=\"deleimg\" src=\"/Public/newcss/img/delete.png\"/> " +
//              "</span>"
                        $("."+classes).html(html);
                        $('input[name="'+classes+'"]').val(data.info);
                    }else{
                        yjfunc.myconfirm(data.info);
                    }
                }
            });
        }

		function getnewUrl(fil,classes) {
			if(fil.length<=0){
				return;
			}
			var Cnv = document.getElementById('myCanvas');
			var Cntx = Cnv.getContext('2d');//获取2d编辑容器
			var imgss =   new Image();
			var agoimg=document.getElementById("agoimg");
			$("."+classes).html("<img style='width: 100%; height: 100%;' src=\"/Public/Home/images/loading.gif\"/>");
//        alert(fil.length);
			for (var intI = 0; intI < fil.length; intI++) {
				var tmpFile = fil[intI];
				var reader = new FileReader();
				reader.readAsDataURL(tmpFile);
				reader.onload = function (e) {
					url = e.target.result;
					imgss.src = url;
					agoimg.src=url;
				};

				agoimg.onload = function () {
					//等比缩放
					var m = imgss.width / imgss.height;
					Cnv.height =1100;//该值影响缩放后图片的大小
					Cnv.width= 1100*m ;
					//img放入画布中
					//设置起始坐标，结束坐标
					Cntx.drawImage(agoimg, 0, 0,1100*m,1100);
					var Pic = document.getElementById("myCanvas").toDataURL("image/png");




				};
			}

		}


	</script>



</html>